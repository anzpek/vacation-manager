<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íœ´ê°€ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mobile.css">
</head>
<body>
    <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
    <div id="loginModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px; margin: 10% auto;">
            <div class="modal-header">
                <h2>ğŸ” ë¶€ì„œ íœ´ê°€ ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
            </div>
            <div class="modal-body">
                <p style="text-align: center; margin-bottom: 20px;">ë¶€ì„œ ì „ìš© ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
                <div class="form-group">
                    <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" style="width: 100%; padding: 12px; font-size: 16px;">
                </div>
                <div id="loginError" style="color: red; display: none; margin-bottom: 10px;"></div>
                <button onclick="handleLogin()" class="btn btn-primary" style="width: 100%; padding: 12px; font-size: 16px;">ë¡œê·¸ì¸</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>íœ´ê°€ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <div class="header-controls">
                <!-- ëª¨ë°”ì¼ ì „ìš© ë²„íŠ¼ë“¤ -->
                <button id="mobileMenuBtn" class="mobile-only">ë©”ë‰´</button>
                <button id="mobileFilterBtn" class="mobile-only">í•„í„°</button>
                
                <!-- ê¸°ì¡´ PC ë²„íŠ¼ë“¤ -->
                <button id="employeeManageBtn" class="btn btn-warning">ë¶€ì„œ ê´€ë¦¬</button>
                <button id="batchInputBtn" class="btn btn-primary">ì¼ê´„ ì…ë ¥</button>
                <button id="batchRegisterBtn" class="btn btn-secondary">ë²”ìœ„ ë“±ë¡</button>
                <button id="firebaseSetupBtn" class="btn btn-info">ì‹¤ì‹œê°„ ê³µìœ  ì„¤ì •</button>
                <button id="firebaseSyncBtn" class="btn btn-success" disabled>Firebase ë™ê¸°í™”</button>
                <button id="exportBtn" class="btn btn-info">ë‚´ë³´ë‚´ê¸°</button>
                <button id="importBtn" class="btn btn-info">ê°€ì ¸ì˜¤ê¸°</button>
                <button id="printBtn" class="btn btn-secondary">ì¸ì‡„</button>
                <input type="file" id="importFile" accept=".json" style="display: none;">
            </div>
        </header>

        <main>
            <div class="main-content-wrapper">
                <!-- í•„í„°ë§ UI -->
                <div class="filter-controls" id="filterControls">
                    <div class="filter-header mobile-only">
                        <h3>í•„í„°</h3>
                        <button id="closeFilterBtn" class="close-btn">Ã—</button>
                    </div>
                    <h3 class="desktop-only">í•„í„°</h3>
                    <div class="filter-section">
                        <label><input type="checkbox" id="selectAllFilterEmployees" checked> ì „ì²´ ì„ íƒ/í•´ì œ</label>
                        <h4>íŒ€ë³„ í•„í„°</h4>
                        <div class="checkbox-group" id="teamFilterCheckboxes">
                            <!-- íŒ€ë³„ ì²´í¬ë°•ìŠ¤ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                    <button id="resetFilterBtn" class="btn btn-secondary">í•„í„° ì´ˆê¸°í™”</button>
                </div>

                <div class="calendar-container">
                    <div class="calendar-header">
                        <button id="prevMonth" class="nav-btn">&lt;</button>
                        <h2 id="currentMonth"></h2>
                        <button id="nextMonth" class="nav-btn">&gt;</button>
                    </div>
                    <!-- ëª¨ë°”ì¼ ì „ìš© ë²„íŠ¼ - ì™¼ìª½ -->
                    <div class="mobile-floating-buttons-left mobile-only">
                        <button id="mobileMenuBtnLeft" class="floating-btn">ë©”ë‰´</button>
                        <button id="mobileFilterBtnLeft" class="floating-btn">í•„í„°</button>
                    </div>
                    <!-- ëª¨ë°”ì¼ ì „ìš© ë²„íŠ¼ - ì˜¤ë¥¸ìª½ -->
                    <div class="mobile-floating-buttons mobile-only">
                        <button id="mobileMenuBtn2" class="floating-btn">ë©”ë‰´</button>
                        <button id="mobileFilterBtn2" class="floating-btn">í•„í„°</button>
                    </div>
                    <div id="calendar" class="calendar"></div>
                </div>
            </div>
        </main>

        <!-- ëª¨ë°”ì¼ ë©”ë‰´ ì˜¤ë²„ë ˆì´ -->
        <div class="mobile-menu-overlay" id="mobileMenuOverlay">
            <div class="mobile-menu-content">
                <div class="mobile-menu-header">
                    <h3>ë©”ë‰´</h3>
                    <button id="closeMobileMenuBtn" class="close-btn">Ã—</button>
                </div>
                <div class="mobile-menu-items">
                    <button class="mobile-menu-item" data-action="employeeManage">ë¶€ì„œ ê´€ë¦¬</button>
                    <button class="mobile-menu-item" data-action="batchInput">ì¼ê´„ ì…ë ¥</button>
                    <button class="mobile-menu-item" data-action="batchRegister">ë²”ìœ„ ë“±ë¡</button>
                    <button class="mobile-menu-item" data-action="firebaseSetup">ì‹¤ì‹œê°„ ê³µìœ  ì„¤ì •</button>
                    <button class="mobile-menu-item" data-action="firebaseSync">Firebase ë™ê¸°í™”</button>
                    <button class="mobile-menu-item" data-action="export">ë‚´ë³´ë‚´ê¸°</button>
                    <button class="mobile-menu-item" data-action="import">ê°€ì ¸ì˜¤ê¸°</button>
                    <button class="mobile-menu-item" data-action="print">ì¸ì‡„</button>
                </div>
            </div>
        </div>

        <!-- ëª¨ë°”ì¼ í•„í„° íŒì—… -->
        <div class="filter-popup mobile-only" id="filterPopup">
            <div class="filter-popup-content">
                <div class="filter-popup-header">
                    <h3>í•„í„°</h3>
                    <button class="close-popup-btn" id="closeFilterPopup" onclick="hideMobileFilter()" onmousedown="this.style.backgroundColor='red';">Ã—</button>
                </div>
                <div class="filter-popup-body">
                    <div class="filter-section">
                        <label><input type="checkbox" id="selectAllFilterEmployeesMobile" checked> ì „ì²´ ì„ íƒ/í•´ì œ</label>
                        <h4>íŒ€ë³„ í•„í„°</h4>
                        <div class="checkbox-group" id="teamFilterCheckboxesMobile">
                            <!-- ëª¨ë°”ì¼ìš© íŒ€ë³„ ì²´í¬ë°•ìŠ¤ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                    <button id="resetFilterBtnMobile" class="btn btn-secondary" style="width: 100%; margin-top: 15px;">í•„í„° ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>

        <!-- ê°œë³„ íœ´ê°€ ë“±ë¡ ëª¨ë‹¬ -->
        <div id="vacationModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>íœ´ê°€ ë“±ë¡</h3>
                <form id="vacationForm">
                    <div class="form-group">
                        <label for="selectedDate">ë‚ ì§œ</label>
                        <input type="text" id="selectedDate" readonly>
                    </div>
                    <div class="form-group">
                        <label for="employeeName">ì§ì› ì´ë¦„</label>
                        <select id="employeeName" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="vacationType">íœ´ê°€ ìœ í˜•</label>
                        <select id="vacationType" required>
                            <option value="ì—°ì°¨">ì—°ì°¨íœ´ê°€</option>
                            <option value="íŠ¹ë³„">íŠ¹ë³„íœ´ê°€</option>
                            <option value="ì˜¤ì „">ì˜¤ì „ë°˜ì°¨</option>
                            <option value="ì˜¤í›„">ì˜¤í›„ë°˜ì°¨</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ë“±ë¡</button>
                        <button type="button" class="btn btn-secondary" id="cancelVacation">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ì¼ê´„ ì…ë ¥ ëª¨ë‹¬ -->
        <div id="batchInputModal" class="modal">
            <div class="modal-content modal-large">
                <span class="close">&times;</span>
                <h3>íœ´ê°€ ì¼ê´„ ì…ë ¥</h3>
                <div class="batch-input-container">
                    <div class="input-section">
                        <h4>ì…ë ¥ í˜•ì‹ ì˜ˆì‹œ</h4>
                        <pre class="example">ì„êµ­ë‹¨
0701
0702
0806(ì˜¤í›„)
0929
1012

ê¹€ì² ìˆ˜
0715(ì˜¤ì „)
0820
0821</pre>
                        <textarea id="batchInputText" placeholder="ì§ì›ëª…ê³¼ íœ´ê°€ ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”..." rows="15"></textarea>
                        <button id="parseBatchInput" class="btn btn-primary">íŒŒì‹±í•˜ê¸°</button>
                    </div>
                    <div class="preview-section">
                        <h4>íŒŒì‹± ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</h4>
                        <div id="parsePreview"></div>
                        <div class="form-actions">
                            <button id="confirmBatchInput" class="btn btn-success" disabled>ë“±ë¡í•˜ê¸°</button>
                            <button id="cancelBatchInput" class="btn btn-secondary">ì·¨ì†Œ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë²”ìœ„ ì¼ê´„ ë“±ë¡ ëª¨ë‹¬ -->
        <div id="batchRegisterModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>ë²”ìœ„ ì¼ê´„ ë“±ë¡</h3>
                <form id="batchRegisterForm">
                    <div class="form-group">
                        <label>ì§ì› ì„ íƒ</label>
                        <div id="employeeCheckboxes" class="checkbox-group"></div>
                    </div>
                    <div class="form-group">
                        <label for="startDate">ì‹œì‘ì¼</label>
                        <input type="date" id="startDate" required>
                    </div>
                    <div class="form-group">
                        <label for="endDate">ì¢…ë£Œì¼</label>
                        <input type="date" id="endDate" required>
                    </div>
                    <div class="form-group">
                        <label for="batchVacationType">íœ´ê°€ ìœ í˜•</label>
                        <select id="batchVacationType" required>
                            <option value="ì—°ì°¨">ì—°ì°¨íœ´ê°€</option>
                            <option value="íŠ¹ë³„">íŠ¹ë³„íœ´ê°€</option>
                            <option value="ì˜¤ì „">ì˜¤ì „ë°˜ì°¨</option>
                            <option value="ì˜¤í›„">ì˜¤í›„ë°˜ì°¨</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="excludeWeekends">
                            <input type="checkbox" id="excludeWeekends" checked>
                            ì£¼ë§ ë° ê³µíœ´ì¼ ì œì™¸
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ë“±ë¡</button>
                        <button type="button" class="btn btn-secondary" id="cancelBatchRegister">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- íœ´ê°€ ìˆ˜ì •/ì‚­ì œ ëª¨ë‹¬ -->
        <div id="editVacationModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>íœ´ê°€ ìˆ˜ì •/ì‚­ì œ</h3>
                <div id="editVacationContent"></div>
            </div>
        </div>

        <!-- ë‹¤ì¤‘ ì›” ì¸ì‡„ ëª¨ë‹¬ -->
        <div id="multiMonthPrintModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>ì¸ì‡„ ì„¤ì •</h3>
                <form id="multiMonthPrintForm">
                    <div class="form-group">
                        <label for="printYear">ì—°ë„ ì„ íƒ</label>
                        <select id="printYear" class="form-control"></select>
                    </div>
                    <div class="form-group">
                        <label>ì¸ì‡„í•  ì›” ì„ íƒ (ìµœëŒ€ 6ê°œì›”)</label>
                        <div id="monthCheckboxesContainer" class="checkbox-group">
                            <!-- ì›” ì²´í¬ë°•ìŠ¤ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ì¸ì‡„</button>
                        <button type="button" class="btn btn-secondary" id="cancelMultiMonthPrint">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ì§ì› ê´€ë¦¬ ëª¨ë‹¬ -->
        <div id="employeeManageModal" class="modal">
            <div class="modal-content modal-large">
                <span class="close">&times;</span>
                <h3>ë¶€ì„œ ê´€ë¦¬</h3>
                <div class="employee-manage-container">
                    <!-- ìƒë‹¨: ë¶€ì„œ, íŒ€, ì§ì› ì¶”ê°€ë¥¼ 3ê°œ ì—´ë¡œ ë°°ì¹˜ -->
                    <div class="add-controls-row">
                        <div class="add-section">
                            <h4>ë¶€ì„œ ì¶”ê°€</h4>
                            <form id="departmentAddForm">
                                <div class="form-group">
                                    <input type="text" id="newDepartmentName" placeholder="ìƒˆ ë¶€ì„œ ì´ë¦„" required>
                                    <button type="submit" class="btn btn-primary">ë¶€ì„œ ì¶”ê°€</button>
                                </div>
                            </form>
                        </div>
                        <div class="add-section">
                            <h4>íŒ€ ì¶”ê°€</h4>
                            <form id="teamAddForm">
                                <div class="form-group">
                                    <input type="text" id="newTeamName" placeholder="ìƒˆ íŒ€ ì´ë¦„" required>
                                    <select id="newTeamDepartment" class="department-select" required>
                                        <option value="">ë¶€ì„œ ì„ íƒ</option>
                                    </select>
                                    <button type="submit" class="btn btn-primary">íŒ€ ì¶”ê°€</button>
                                </div>
                            </form>
                        </div>
                        <div class="add-section">
                            <h4>ì§ì› ì¶”ê°€</h4>
                            <form id="employeeAddForm">
                                <div class="form-group">
                                    <input type="text" id="newEmployeeName" placeholder="ì§ì› ì´ë¦„" required>
                                    <select id="newEmployeeDepartment" class="department-select" required>
                                        <option value="">ë¶€ì„œ ì„ íƒ</option>
                                    </select>
                                    <select id="newEmployeeTeam" class="team-select">
                                        <option value="">íŒ€ ì„ íƒ</option>
                                    </select>
                                    <select id="newEmployeeRole" class="role-select" required>
                                        <option value="member">íŒ€ì›</option>
                                        <option value="leader">íŒ€ì¥</option>
                                        <option value="manager">ë¶€ì¥</option>
                                    </select>
                                    <button type="submit" class="btn btn-primary">ì§ì› ì¶”ê°€</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- í•˜ë‹¨: ë¶€ì„œ ë° ì§ì› ê´€ë¦¬ ì „ì²´ ê³µê°„ í™œìš© -->
                    <div class="manage-section">
                        <h4>ë¶€ì„œ ë° ì§ì› ê´€ë¦¬</h4>
                        <div class="combined-list" id="combinedEmployeeList">
                            <!-- ë¶€ì„œ, íŒ€, ì§ì›ì´ í•¨ê»˜ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="config/firebase-config.js"></script>
    <script src="js/password.js"></script>
    <script src="js/holidays.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/firebase-sync.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/vacation.js"></script>
    <script src="js/textParser.js"></script>
    <script src="js/print.js"></script>

    <!-- ë¡œê·¸ì¸ ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ë¡œê·¸ì¸ ì²´í¬
        function checkLogin() {
            const isAuthenticated = sessionStorage.getItem('authenticated');
            const loginTime = sessionStorage.getItem('loginTime');
            
            if (!isAuthenticated || !loginTime) {
                showLoginModal();
                return false;
            }
            
            // 24ì‹œê°„ ì„¸ì…˜ ë§Œë£Œ ì²´í¬
            const now = Date.now();
            const loginTimestamp = parseInt(loginTime);
            const twentyFourHours = 24 * 60 * 60 * 1000;
            
            if (now - loginTimestamp >= twentyFourHours) {
                sessionStorage.removeItem('authenticated');
                sessionStorage.removeItem('loginTime');
                showLoginModal();
                return false;
            }
            
            return true;
        }
        
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        function hideLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.body.style.overflow = '';
        }
        
        function handleLogin() {
            const password = document.getElementById('loginPassword').value;
            const errorMsg = document.getElementById('loginError');
            
            if (checkPassword(password)) {
                sessionStorage.setItem('authenticated', 'true');
                sessionStorage.setItem('loginTime', Date.now().toString());
                hideLoginModal();
                document.getElementById('loginPassword').value = '';
                errorMsg.style.display = 'none';
                
                // ë¡œê·¸ì¸ ì„±ê³µ í›„ ê¸°ì¡´ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
                initializeSystem();
            } else {
                errorMsg.style.display = 'block';
                errorMsg.textContent = 'ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.';
            }
        }
        
        function initializeSystem() {
            // ê¸°ì¡´ ì‹œìŠ¤í…œ ì´ˆê¸°í™” (ì›ë³¸ ê·¸ëŒ€ë¡œ)
            console.log('DOM ë¡œë“œ ì™„ë£Œ, ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™” ì‹œì‘');
            
            storage.init();
            
            if (typeof calendar !== 'undefined') {
                calendar.init();
            }
            
            vacationManager.init();
            
            if (typeof textParser !== 'undefined') {
                textParser.init();
            }
            
            if (typeof printManager !== 'undefined') {
                printManager.init();
            }
            
            initFirebase();
            
            console.log('ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™” ì™„ë£Œ');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ì²´í¬
        document.addEventListener('DOMContentLoaded', function() {
            if (checkLogin()) {
                initializeSystem();
            }
            
            // ëª¨ë°”ì¼ UI ì´ˆê¸°í™”
            initializeMobileUI();
        });
        
        // ëª¨ë°”ì¼ UI ì´ˆê¸°í™”
        function initializeMobileUI() {
            // ëª¨ë°”ì¼ ë©”ë‰´ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('mobileMenuBtn').addEventListener('click', showMobileMenu);
            document.getElementById('mobileMenuBtnLeft').addEventListener('click', showMobileMenu);
            document.getElementById('mobileMenuBtn2').addEventListener('click', showMobileMenu);
            document.getElementById('closeMobileMenuBtn').addEventListener('click', hideMobileMenu);

            // ëª¨ë°”ì¼ í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('mobileFilterBtn').addEventListener('click', showMobileFilter);
            document.getElementById('mobileFilterBtnLeft').addEventListener('click', showMobileFilter);
            document.getElementById('mobileFilterBtn2').addEventListener('click', showMobileFilter);
            
            const closeFilterPopupBtn = document.getElementById('closeFilterPopup');
            if (closeFilterPopupBtn) {
                console.log('closeFilterPopupBtn found:', closeFilterPopupBtn);
                // onclick ì†ì„±ì„ HTMLì— ì§ì ‘ ì¶”ê°€í–ˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œ ì„¤ì •í•  í•„ìš” ì—†ìŒ
            } else {
                console.error('closeFilterPopupBtn not found!');
            }

            // ëª¨ë°”ì¼ ë©”ë‰´ ì•„ì´í…œ ì´ë²¤íŠ¸
            document.querySelectorAll('.mobile-menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const action = this.dataset.action;
                    hideMobileMenu();
                    
                    // í•´ë‹¹ PC ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì‹¤í–‰
                    const btn = document.getElementById(action + 'Btn');
                    if(btn) btn.click();
                });
            });
            
            // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸°
            document.getElementById('mobileMenuOverlay').addEventListener('click', function(e) {
                if (e.target === this) hideMobileMenu();
            });
            
            // í•„í„° íŒì—… ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            document.getElementById('filterPopup').addEventListener('click', function(e) {
                if (e.target === this || e.target.classList.contains('filter-popup')) {
                    hideMobileFilter();
                }
            });
            
            // ESC í‚¤ë¡œ ë‹«ê¸°
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    hideMobileMenu();
                    hideMobileFilter();
                }
            });
            
            // ëª¨ë°”ì¼ í•„í„° ì´ˆê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('resetFilterBtnMobile')?.addEventListener('click', function() {
                const pcResetBtn = document.getElementById('resetFilterBtn');
                if (pcResetBtn) {
                    pcResetBtn.click();
                }
                // ëª¨ë°”ì¼ ì²´í¬ë°•ìŠ¤ë„ ëª¨ë‘ ì²´í¬
                const mobileCheckboxes = document.querySelectorAll('#teamFilterCheckboxesMobile input[type="checkbox"]');
                mobileCheckboxes.forEach(checkbox => checkbox.checked = true);
                const selectAllMobile = document.getElementById('selectAllFilterEmployeesMobile');
                if (selectAllMobile) selectAllMobile.checked = true;
            });
        }
        
        function showMobileMenu() {
            document.getElementById('mobileMenuOverlay').classList.add('active');
        }

        function hideMobileMenu() {
            document.getElementById('mobileMenuOverlay').classList.remove('active');
        }

        function showMobileFilter() {
            console.log('showMobileFilter called');
            const popup = document.getElementById('filterPopup');
            const pcContainer = document.getElementById('teamFilterCheckboxes');
            const mobileContainer = document.getElementById('teamFilterCheckboxesMobile');

            if (pcContainer && mobileContainer) {
                // PC í•„í„°ì˜ HTMLì„ ëª¨ë°”ì¼ ì»¨í…Œì´ë„ˆë¡œ ë³µì‚¬
                mobileContainer.innerHTML = pcContainer.innerHTML;

                // PCì™€ ëª¨ë°”ì¼ì˜ ì²´í¬ë°•ìŠ¤ë“¤ì„ ê°€ì ¸ì˜´
                const pcCheckboxes = pcContainer.querySelectorAll('input[type="checkbox"]');
                const mobileCheckboxes = mobileContainer.querySelectorAll('input[type="checkbox"]');

                // ìƒíƒœ ë™ê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                mobileCheckboxes.forEach((mobileCb, index) => {
                    const pcCb = pcCheckboxes[index];
                    if (pcCb) {
                        // 1. ìƒíƒœ ë™ê¸°í™”: PC ì²´í¬ë°•ìŠ¤ì˜ í˜„ì¬ ìƒíƒœë¥¼ ëª¨ë°”ì¼ ì²´í¬ë°•ìŠ¤ì— ë°˜ì˜
                        mobileCb.checked = pcCb.checked;

                        // 2. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€: ëª¨ë°”ì¼ ì²´í¬ë°•ìŠ¤ë¥¼ ë³€ê²½í•˜ë©´ PC ì²´í¬ë°•ìŠ¤ë„ í•¨ê»˜ ë³€ê²½í•˜ê³ , PCì˜ í•„í„°ë§ ê¸°ëŠ¥ì„ ì‹¤í–‰
                        mobileCb.addEventListener('change', () => {
                            pcCb.checked = mobileCb.checked;
                            pcCb.dispatchEvent(new Event('change', { bubbles: true }));
                        });
                    }
                });

                // 'ì „ì²´ ì„ íƒ/í•´ì œ' ì²´í¬ë°•ìŠ¤ë„ ë™ì¼í•˜ê²Œ ì²˜ë¦¬
                const pcSelectAll = document.getElementById('selectAllFilterEmployees');
                const mobileSelectAll = document.getElementById('selectAllFilterEmployeesMobile');
                if (pcSelectAll && mobileSelectAll) {
                    mobileSelectAll.checked = pcSelectAll.checked;
                    mobileSelectAll.addEventListener('change', () => {
                        pcSelectAll.checked = mobileSelectAll.checked;
                        pcSelectAll.dispatchEvent(new Event('change', { bubbles: true }));
                    });
                }
            }
            popup.classList.add('active');
        }

        function hideMobileFilter() {
            console.log('hideMobileFilter called');
            const popup = document.getElementById('filterPopup');
            popup.classList.remove('active');
            console.log('filterPopup classes:', popup.classList);
        }
        
        // ëª¨ë°”ì¼ í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
        document.getElementById('mobileFilterBtn2')?.addEventListener('click', showMobileFilter);
        document.getElementById('mobileFilterBtnLeft')?.addEventListener('click', showMobileFilter);
        document.getElementById('closeFilterPopup')?.addEventListener('click', hideMobileFilter);
        
        // ëª¨ë°”ì¼ ë©”ë‰´ ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
        document.getElementById('mobileMenuBtn2')?.addEventListener('click', showMobileMenu);
        document.getElementById('mobileMenuBtnLeft')?.addEventListener('click', showMobileMenu);
        
        // ëª¨ë°”ì¼ í•„í„° íŒì—… ê´€ë ¨ í•¨ìˆ˜
        function showMobileFilterPopup() {
            console.log('showMobileFilterPopup called');
            const popup = document.getElementById('filterPopup');
            const pcContainer = document.getElementById('teamFilterCheckboxes');
            const mobileContainer = document.getElementById('teamFilterCheckboxesMobile');

            if (pcContainer && mobileContainer) {
                // PC í•„í„°ì˜ HTMLì„ ëª¨ë°”ì¼ ì»¨í…Œì´ë„ˆë¡œ ë³µì‚¬
                mobileContainer.innerHTML = pcContainer.innerHTML;

                // PCì™€ ëª¨ë°”ì¼ì˜ ì²´í¬ë°•ìŠ¤ë“¤ì„ ê°€ì ¸ì˜´
                const pcCheckboxes = pcContainer.querySelectorAll('input[type="checkbox"]');
                const mobileCheckboxes = mobileContainer.querySelectorAll('input[type="checkbox"]');

                // ìƒíƒœ ë™ê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                mobileCheckboxes.forEach((mobileCb, index) => {
                    const pcCb = pcCheckboxes[index];
                    if (pcCb) {
                        // 1. ìƒíƒœ ë™ê¸°í™”: PC ì²´í¬ë°•ìŠ¤ì˜ í˜„ì¬ ìƒíƒœë¥¼ ëª¨ë°”ì¼ ì²´í¬ë°•ìŠ¤ì— ë°˜ì˜
                        mobileCb.checked = pcCb.checked;

                        // 2. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€: ëª¨ë°”ì¼ ì²´í¬ë°•ìŠ¤ë¥¼ ë³€ê²½í•˜ë©´ PC ì²´í¬ë°•ìŠ¤ë„ í•¨ê»˜ ë³€ê²½í•˜ê³ , PCì˜ í•„í„°ë§ ê¸°ëŠ¥ì„ ì‹¤í–‰
                        mobileCb.addEventListener('change', () => {
                            pcCb.checked = mobileCb.checked;
                            pcCb.dispatchEvent(new Event('change', { bubbles: true }));
                        });
                    }
                });

                // 'ì „ì²´ ì„ íƒ/í•´ì œ' ì²´í¬ë°•ìŠ¤ë„ ë™ì¼í•˜ê²Œ ì²˜ë¦¬
                const pcSelectAll = document.getElementById('selectAllFilterEmployees');
                const mobileSelectAll = document.getElementById('selectAllFilterEmployeesMobile');
                if (pcSelectAll && mobileSelectAll) {
                    mobileSelectAll.checked = pcSelectAll.checked;
                    mobileSelectAll.addEventListener('change', () => {
                        pcSelectAll.checked = mobileSelectAll.checked;
                        pcSelectAll.dispatchEvent(new Event('change', { bubbles: true }));
                    });
                }
            }
            popup.classList.add('active');
        }
        

        
        // ëª¨ë°”ì¼ ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤
        document.getElementById('selectAllFilterEmployeesMobile')?.addEventListener('change', function() {
            const pcSelectAll = document.getElementById('selectAllFilterEmployees');
            if (pcSelectAll) {
                pcSelectAll.checked = this.checked;
                pcSelectAll.dispatchEvent(new Event('change'));
            }
        });
        
        // ëª¨ë°”ì¼ í•„í„° ì´ˆê¸°í™” ë²„íŠ¼
        document.getElementById('resetFilterBtnMobile')?.addEventListener('click', function() {
            const pcResetBtn = document.getElementById('resetFilterBtn');
            if (pcResetBtn) {
                pcResetBtn.click();
            }
            // ëª¨ë°”ì¼ ì²´í¬ë°•ìŠ¤ë„ ëª¨ë‘ ì²´í¬
            const mobileCheckboxes = document.querySelectorAll('#teamFilterCheckboxesMobile input[type="checkbox"]');
            mobileCheckboxes.forEach(checkbox => checkbox.checked = true);
            document.getElementById('selectAllFilterEmployeesMobile').checked = true;
        });
        

        

        
        // ì—”í„° í‚¤ë¡œ ë¡œê·¸ì¸
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('loginModal').style.display === 'block') {
                handleLogin();
            }
        });
    </script>

    <!-- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì¶”ê°€ -->
    <script>
        function parseDateString(dateStr) {
            return new Date(dateStr);
        }

        function formatDateToYYYYMMDD(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Firebase ì´ˆê¸°í™” ë° ë²„íŠ¼ ì´ë²¤íŠ¸
        async function initFirebase() {
            document.getElementById('firebaseSetupBtn').addEventListener('click', () => {
                window.location.href = 'firebase-setup.html';
            });

            document.getElementById('firebaseSyncBtn').addEventListener('click', async () => {
                if (firebaseSync.isOnline()) {
                    const success = await firebaseSync.syncToFirebase();
                    if (success) {
                        alert('Firebaseì— ë°ì´í„°ê°€ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        alert('ë™ê¸°í™” ì‹¤íŒ¨. ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    }
                } else {
                    alert('Firebaseê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì‹¤ì‹œê°„ ê³µìœ  ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            });

            try {
                const connected = await firebaseSync.init();
                
                if (connected) {
                    document.getElementById('firebaseSyncBtn').disabled = false;
                    document.getElementById('firebaseSyncBtn').textContent = 'Firebase ë™ê¸°í™” âœ…';
                    await firebaseSync.loadFromFirebase();
                    console.log('Firebase ìë™ ì—°ê²° ì„±ê³µ! ì‹¤ì‹œê°„ ë™ê¸°í™”ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    console.log('Firebase ìë™ ì—°ê²° ì‹¤íŒ¨. ë¡œì»¬ ëª¨ë“œë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Firebase ìë™ ì—°ê²° ì‹¤íŒ¨:', error);
            }
        }

        // storage í•¨ìˆ˜ë“¤ì„ ì˜¤ë²„ë¼ì´ë“œí•´ì„œ Firebase ë™ê¸°í™” ì¶”ê°€
        const originalAddVacation = storage.addVacation;
        storage.addVacation = function(date, employee, type) {
            const result = originalAddVacation.call(this, date, employee, type);
            if (firebaseSync.isOnline()) {
                firebaseSync.syncToFirebase();
            }
            return result;
        };

        const originalRemoveVacation = storage.removeVacation;
        storage.removeVacation = function(date, employee) {
            const result = originalRemoveVacation.call(this, date, employee);
            if (firebaseSync.isOnline()) {
                firebaseSync.syncToFirebase();
            }
            return result;
        };

        const originalSaveEmployees = storage.saveEmployees;
        storage.saveEmployees = function(employees) {
            const result = originalSaveEmployees.call(this, employees);
            if (firebaseSync.isOnline()) {
                firebaseSync.syncToFirebase();
            }
            return result;
        };

        const originalSaveDepartments = storage.saveDepartments;
        storage.saveDepartments = function(departments) {
            const result = originalSaveDepartments.call(this, departments);
            if (firebaseSync.isOnline()) {
                firebaseSync.syncToFirebase();
            }
            return result;
        };
        
        // ëª¨ë°”ì¼ UI ì´ˆê¸°í™”
        initializeMobileUI();
    </script>
</body>
</html>